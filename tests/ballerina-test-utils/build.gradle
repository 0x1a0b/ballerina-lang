apply from: "$rootDir/gradle/javaProject.gradle"
apply plugin: 'com.github.johnrengelman.shadow'

configurations {
    commonBackend
}

dependencies {
    implementation project(':ballerina-lang')
    implementation project(':ballerina-core')
    implementation project(':ballerina-runtime')
    implementation project(':ballerina-launcher')
    implementation project(':ballerina-backend-jvm')

    implementation 'org.javassist:javassist'
    implementation 'io.netty:netty-codec-http'
    implementation 'org.apache.commons:commons-lang3'
    implementation 'org.wso2.transport.http:org.wso2.transport.http.netty'
    implementation 'org.testng:testng'
}

jar {
    enabled = false
    dependsOn(shadowJar { classifier = null })
    manifest {
        attributes(
                'Implementation-Title': 'Ballerina - Test Utils',
                'Implementation-Version': version,
                'Premain-Class': 'org.ballerinalang.test.agent.BallerinaServerAgent'
        )
    }
}

shadowJar {
    configurations = [project.configurations.runtimeClasspath]
    dependencies {
        exclude('org.slf4j:slf4j-api')
        exclude('org.apache.commons:commons-lang3')
        exclude('org.wso2.transport.http:org.wso2.transport.http.netty')
        exclude('org.wso2.eclipse.osgi:org.eclipse.osgi')
        exclude('org.wso2.eclipse.osgi:org.eclipse.osgi.services')
        exclude('org.slf4j:slf4j-log4j12')
        exclude('org.slf4j:slf4j-simple')
        exclude('org.codehaus.woodstox:woodstox-core-asl')
        exclude('org.codehaus.woodstox:stax2-api')
        exclude('io.netty:netty-common')
        exclude('io.netty:netty-buffer')
        exclude('io.netty:netty-transport')
        exclude('io.netty:netty-handler')
        exclude('io.netty:netty-codec')
        exclude('io.netty:netty-handler-proxy')
        exclude('io.netty:netty-codec-socks')
        exclude('io.netty:netty-codec-http2')
        exclude('io.netty:netty-resolver')
        exclude('commons-pool.wso2:commons-pool')
        exclude('commons-pool:commons-pool')
        exclude('org.wso2.orbit.org.yaml:snakeyaml')
        exclude('org.bouncycastle:bcprov-jdk15on')
        exclude('org.bouncycastle:bcpkix-jdk15on')
        exclude('io.netty:netty-tcnative-boringssl-static')
        exclude('org.testng:testng')
        exclude('com.beust:jcommander')
        exclude('io.netty:netty-codec-http')
        exclude('io.netty:netty-transport-native-unix-common')
        exclude('META-INF/*.SF')
        exclude('META-INF/*.DSA')
        exclude('META-INF/*.RSA')
    }
}

build.dependsOn shadowJar

artifacts {
    commonBackend file: file('src/main/ballerina/httpService/common_backend.bal')
}
